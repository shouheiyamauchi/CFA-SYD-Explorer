
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/3.5.0/lodash.min.js"></script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.2.6/gridstack.min.css" />
<script type="text/javascript" src='//cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.2.6/gridstack.min.js'></script>
<!DOCTYPE html>
<html lang="en">
<head>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serialization demo</title>

    <style type="text/css">
        .grid-stack {
            background: lightgoldenrodyellow;
        }

        .grid-stack-item-content {
            color: #2c3e50;
            text-align: center;
            background-color: #18bc9c;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <h1>Serialization demo</h1>

        <div>
            <a class="btn btn-default" id="save-grid" href="#">Save Grid</a>
        </div>

        <br/>

        <div class="grid-stack">
          <div class="grid-stack-item" data-gs-x=<%= @dashboard_grid[0]["x"] %> data-gs-y=<%= @dashboard_grid[0]["y"] %> data-gs-width=<%= @dashboard_grid[0]["width"] %> data-gs-height=<%= @dashboard_grid[0]["height"] %> data-custom-id=<%= @dashboard_grid[0]["map"] %>><div class="grid-stack-item-content">0</div></div>
          <div class="grid-stack-item" data-gs-x=<%= @dashboard_grid[1]["x"] %> data-gs-y=<%= @dashboard_grid[1]["y"] %> data-gs-width=<%= @dashboard_grid[1]["width"] %> data-gs-height=<%= @dashboard_grid[1]["height"] %> data-custom-id=<%= @dashboard_grid[1]["events"] %>><div class="grid-stack-item-content">1</div></div>
          <div class="grid-stack-item" data-gs-x=<%= @dashboard_grid[2]["x"] %> data-gs-y=<%= @dashboard_grid[2]["y"] %> data-gs-width=<%= @dashboard_grid[2]["width"] %> data-gs-height=<%= @dashboard_grid[2]["height"] %> data-gs-min-width="2" data-gs-no-resize="yes" data-custom-id=<%= @dashboard_grid[2]["calendar"] %>><div class="grid-stack-item-content"> <span class="fa fa-hand-o-up"></span> Drag me! </div></div>
          <div class="grid-stack-item" data-gs-x=<%= @dashboard_grid[3]["x"] %> data-gs-y=<%= @dashboard_grid[3]["y"] %> data-gs-width=<%= @dashboard_grid[3]["width"] %> data-gs-height=<%= @dashboard_grid[3]["height"] %> data-custom-id=<%= @dashboard_grid[3]["event_attendance_history"] %>><div class="grid-stack-item-content">3</div></div>
          <div class="grid-stack-item" data-gs-x=<%= @dashboard_grid[4]["x"] %> data-gs-y=<%= @dashboard_grid[4]["y"] %> data-gs-width=<%= @dashboard_grid[4]["width"] %> data-gs-height=<%= @dashboard_grid[4]["height"] %> data-custom-id=<%= @dashboard_grid[4]["children"] %>><div class="grid-stack-item-content">4</div></div>
        </div>

        <hr/>
        <%= form_tag pages_save_grid_path, :id => 'save_grid_form' do %>
          <textarea id="saved-data" name="dashboard_grid" cols="100" rows="20" readonly="readonly"></textarea>
          <div class="actions">
            <%= submit_tag "Submit", :class => "btn" %>
          </div>
        <% end %>
    </div>


    <script type="text/javascript">
        $(function () {
            var options = {
              verticalMargin: 20
            };
            $('.grid-stack').gridstack(options);

            new function () {

                this.saveGrid = function () {
                  var res = _.map($('.grid-stack .grid-stack-item:visible'), function (el) {
                      el = $(el);
                      var node = el.data('_gridstack_node');
                      return {
                          id: el.attr('data-custom-id'),
                          x: node.x,
                          y: node.y,
                          width: node.width,
                          height: node.height
                      };
                    }, this);
                    $('#saved-data').val(JSON.stringify(res, null, '    '));
                    return false;
                }.bind(this);

                this.submitForm = function() {
                  document.getElementById("save_grid_form").submit();
                  return false;
                }

                $('#save-grid').click(this.saveGrid);
                $('#save-grid').click(this.submitForm);
            };
        });
    </script>
</body>
</html>
